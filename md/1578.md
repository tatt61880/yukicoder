例えば、 \(A\) が最終的に何回かけられるかに注目すると、 \(2^K\) 回であることがわかります。  
\(A^{2^K} B^{2^K} C^{2^K}\)  
の値が黒板に書かれる事になります。

以下、\(\mathrm{mod} = 10 ^ 9 + 7\) とします。  
\(A^{2^K} \% \mathrm{mod}\) は、フェルマーの小定理より、\(A^{2^K \% (\mathrm{mod} - 1)} \% \mathrm{mod}\) と等しいです。  
\(p = 2^K \% (\mathrm{mod} - 1)\) の値を求めておくことで、 \(A^p \% \mathrm{mod}\) の値を求めると良いことがわかります。
\(B\), \(C\) に関しても同様です。
